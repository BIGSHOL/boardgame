# User Flow (사용자 흐름도)

> Hanyang: The Foundation - 사용자 여정 및 화면 흐름

---

## MVP 캡슐

| # | 항목 | 내용 |
|---|------|------|
| 1 | 목표 | 보드게임 프로토타입을 디지털로 테스트하여 실제 제작 전 밸런싱 검증 |
| 2 | 페르소나 | 보드게임 동호회 회원 및 게임 디자이너 본인 |
| 3 | 핵심 기능 | FEAT-2: 워커 파견 및 자원 관리 (전략적 선택의 핵심) |
| 4 | 성공 지표 (노스스타) | 동호회원 5명이 완전한 게임 1판 테스트 완료 |
| 5 | 입력 지표 | 테스트 세션 수, 수집된 피드백 수 |
| 6 | 비기능 요구 | 빠른 게임 시작 (3분 이내 세팅), 실시간 멀티플레이 지원 |
| 7 | Out-of-scope | AI 상대, 랭킹 시스템, 모바일 네이티브 앱 |
| 8 | Top 리스크 | 복잡한 게임 룰로 인한 구현 난이도 |
| 9 | 완화/실험 | 핵심 메카닉(워커/자원)부터 점진적 구현 |
| 10 | 다음 단계 | 기본 게임 보드 UI 및 워커 배치 로직 구현 |

---

## 1. 전체 사용자 여정 (Overview)

```mermaid
graph TD
    A[웹사이트 접속] --> B{로그인 상태?}
    B -->|No| C[FEAT-0: 로그인/회원가입]
    B -->|Yes| D[메인 로비]
    C --> D

    D --> E{어떤 액션?}
    E -->|게임 생성| F[게임 로비 생성]
    E -->|게임 참가| G[초대 코드로 참가]
    E -->|혼자 테스트| H[솔로 테스트 모드]

    F --> I[플레이어 대기]
    G --> I
    I --> J{모두 준비?}
    J -->|Yes| K[게임 시작]
    J -->|No| I

    H --> K
    K --> L[FEAT-1/2/3: 게임 플레이]
    L --> M{게임 종료?}
    M -->|Yes| N[결과 화면]
    M -->|No| L

    N --> O[피드백 수집]
    O --> D
```

---

## 2. FEAT-0: 온보딩/로그인 플로우

```mermaid
graph TD
    A[시작 화면] --> B{계정 있음?}

    %% 신규 사용자
    B -->|No| C[회원가입]
    C --> D[이메일 입력]
    D --> E[비밀번호 설정]
    E --> F[닉네임 설정]
    F --> G[가입 완료]
    G --> H[간단 튜토리얼]
    H --> I[메인 로비]

    %% 기존 사용자
    B -->|Yes| J[로그인]
    J --> K[이메일/비밀번호 입력]
    K --> L{로그인 성공?}
    L -->|Yes| I
    L -->|No| M[에러 표시]
    M --> K

    %% 비회원 관전
    A --> N[비회원 관전]
    N --> O[관전 전용 모드]
```

---

## 3. 게임 로비 플로우

```mermaid
graph TD
    A[메인 로비] --> B{새 게임/참가?}

    %% 게임 생성
    B -->|새 게임| C[게임 설정]
    C --> D[플레이어 수 선택 2-4]
    D --> E[게임 규칙 옵션]
    E --> F[로비 생성 완료]
    F --> G[초대 코드 발급]
    G --> H[대기실]

    %% 게임 참가
    B -->|참가| I[초대 코드 입력]
    I --> J{코드 유효?}
    J -->|Yes| H
    J -->|No| K[코드 오류]
    K --> I

    %% 대기실
    H --> L[플레이어 목록]
    L --> M{방장?}
    M -->|Yes| N[게임 시작 버튼]
    M -->|No| O[준비 버튼]

    O --> P{준비 완료?}
    P -->|Yes| Q[준비 표시]
    P -->|No| O

    N --> R{모두 준비?}
    R -->|Yes| S[게임 시작]
    R -->|No| T[시작 불가 안내]
    T --> L
```

---

## 4. FEAT-1: 게임 보드 및 타일 배치 플로우

```mermaid
graph TD
    A[게임 화면 진입] --> B[보드 렌더링]

    B --> C[메인 보드 표시]
    C --> D[개인 보드 표시]
    D --> E[현재 턴 표시]

    E --> F{내 턴?}
    F -->|No| G[다른 플레이어 대기]
    G --> H[실시간 보드 업데이트]
    H --> F

    F -->|Yes| I[액션 선택]
    I --> J{건설 액션?}

    J -->|Yes| K[건물 타일 선택]
    K --> L[배치 위치 선택]
    L --> M{유효한 위치?}
    M -->|Yes| N[자원 비용 확인]
    M -->|No| O[배치 불가 안내]
    O --> L

    N --> P{자원 충분?}
    P -->|Yes| Q[타일 배치 확정]
    P -->|No| R[자원 부족 안내]
    R --> I

    Q --> S[보드 업데이트]
    S --> T[다음 턴으로]
```

---

## 5. FEAT-2: 워커 파견 및 자원 관리 플로우 (MVP)

```mermaid
graph TD
    A[내 턴 시작] --> B[액션 선택]

    B --> C{어떤 액션?}

    %% 자원 획득 (개인 보드)
    C -->|자원 획득| D[개인 보드 선택]
    D --> E[견습공 배치할 슬롯 선택]
    E --> F{슬롯 유형?}
    F -->|채석장| G[석재 +2]
    F -->|벌목장| H[목재 +2]
    F -->|기와 가마| I[기와 +1]
    G --> J[자원 획득 완료]
    H --> J
    I --> J
    J --> K[견습공 회수]
    K --> L[턴 종료]

    %% 건설 (메인 보드)
    C -->|건설| M[메인 보드 선택]
    M --> N[건물 타일 선택]
    N --> O[배치 위치 선택]
    O --> P{자원 충분?}
    P -->|No| Q[자원 부족 안내]
    Q --> B
    P -->|Yes| R[자원 소비]
    R --> S[관료 파견]
    S --> T{관료 있음?}
    T -->|No| U[관료 부족 안내]
    U --> B
    T -->|Yes| V[관료 메인 보드 배치]
    V --> W[건물 효과 발동]
    W --> L

    %% 카드 드래프팅
    C -->|설계| X[카드 마켓 확인]
    X --> Y[청사진 카드 선택]
    Y --> Z[카드 획득]
    Z --> L

    %% 카드 등록
    C -->|등록| AA[보유 카드 확인]
    AA --> AB[카드 선택]
    AB --> AC[개인 보드에 등록]
    AC --> AD[패시브 효과 활성화]
    AD --> L
```

---

## 6. FEAT-3: 풍수지리 보너스 플로우

```mermaid
graph TD
    A[건물 배치 완료] --> B[위치 분석]

    B --> C{산 방향 체크}
    C --> D{북쪽에 산?}
    D -->|Yes| E[배산 조건 충족]
    D -->|No| F[배산 조건 미충족]

    E --> G{남쪽에 물?}
    F --> G

    G -->|Yes| H[임수 조건 충족]
    G -->|No| I[임수 조건 미충족]

    H --> J{배산임수 완성?}
    I --> J
    J -->|Yes| K[황금 토큰 보너스]
    J -->|No| L[부분 보너스]

    K --> M[보너스 점수 표시]
    L --> M

    %% 인접 시너지
    M --> N[인접 건물 체크]
    N --> O{시너지 조건?}
    O -->|시장+주거| P[상업 보너스]
    O -->|관청+사찰| Q[문화 보너스]
    O -->|없음| R[시너지 없음]

    P --> S[시너지 효과 적용]
    Q --> S
    R --> S

    S --> T[최종 점수 계산]
```

---

## 7. 게임 종료 플로우

```mermaid
graph TD
    A[게임 진행 중] --> B{사대문 완성?}

    B -->|No| C[다음 턴]
    C --> A

    B -->|Yes| D[게임 종료 선언]
    D --> E[최종 라운드]
    E --> F[점수 계산]

    F --> G[건물 점수]
    G --> H[풍수 보너스]
    H --> I[인접 시너지]
    I --> J[사대문 기여도]
    J --> K[총점 집계]

    K --> L[결과 화면]
    L --> M[순위 발표]
    M --> N[피드백 입력]

    N --> O{피드백 작성?}
    O -->|Yes| P[피드백 저장]
    O -->|No| Q[건너뛰기]

    P --> R[메인 로비로]
    Q --> R
```

---

## 8. 실시간 동기화 플로우

```mermaid
graph TD
    A[게임 중] --> B[플레이어 액션]
    B --> C[서버로 전송]

    C --> D[서버 검증]
    D --> E{유효한 액션?}

    E -->|No| F[에러 응답]
    F --> G[액션 취소 안내]
    G --> B

    E -->|Yes| H[게임 상태 업데이트]
    H --> I[모든 클라이언트에 브로드캐스트]

    I --> J[각 클라이언트 UI 업데이트]
    J --> K[애니메이션 재생]
    K --> L{내 턴?}
    L -->|Yes| B
    L -->|No| M[대기 상태]
    M --> N[상대 턴 관찰]
    N --> J
```

---

## 9. 에러 처리 플로우

```mermaid
graph TD
    A[에러 발생] --> B{에러 유형?}

    B -->|연결 끊김| C[재연결 시도]
    C --> D{3회 이내 성공?}
    D -->|Yes| E[게임 상태 복구]
    D -->|No| F[오프라인 안내]
    F --> G[게임 일시정지]

    B -->|잘못된 액션| H[액션 불가 안내]
    H --> I[유효한 액션 힌트]
    I --> J[재시도]

    B -->|자원 부족| K[부족 자원 표시]
    K --> L[대안 액션 제안]

    B -->|턴 타임아웃| M[자동 패스]
    M --> N[다음 플레이어로]

    B -->|서버 오류| O[잠시 후 재시도]
    O --> P{복구 성공?}
    P -->|Yes| E
    P -->|No| Q[게임 저장 후 종료]
```

---

## 10. 화면 목록 (Screen Inventory)

| 화면 ID | 화면명 | FEAT | 진입점 | 주요 액션 |
|---------|--------|------|--------|----------|
| S-01 | 시작 화면 | FEAT-0 | URL 접속 | 로그인/가입/관전 선택 |
| S-02 | 로그인 | FEAT-0 | S-01 | 이메일/비밀번호 입력 |
| S-03 | 회원가입 | FEAT-0 | S-01 | 계정 생성 |
| S-04 | 메인 로비 | - | S-02 | 게임 생성/참가 |
| S-05 | 게임 설정 | - | S-04 | 플레이어 수, 규칙 설정 |
| S-06 | 대기실 | - | S-05 | 플레이어 대기, 준비 |
| S-07 | 게임 화면 | FEAT-1/2/3 | S-06 | 게임 플레이 |
| S-08 | 개인 보드 | FEAT-2 | S-07 | 자원 관리, 카드 등록 |
| S-09 | 메인 보드 | FEAT-1/3 | S-07 | 타일 배치, 워커 파견 |
| S-10 | 결과 화면 | - | S-07 | 점수 확인, 피드백 |

---

## 11. 화면 상세

### S-07: 게임 화면 레이아웃

```
┌─────────────────────────────────────────────────────────────┐
│ [턴 표시] 현재: 플레이어2  라운드: 3/8   [설정] [나가기]   │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│                    ┌─────────────────┐                      │
│                    │                 │                      │
│                    │   메인 보드     │                      │
│    플레이어1       │   (한양 지도)   │       플레이어2      │
│    [프로필]        │                 │       [프로필]       │
│    자원: ...       │   N(산)         │       자원: ...      │
│                    │   ┌───┬───┐     │                      │
│                    │   │   │   │     │                      │
│                    │   ├───┼───┤     │                      │
│                    │   │   │   │     │                      │
│                    │   └───┴───┘     │                      │
│                    │   S(물)         │                      │
│    플레이어3       │                 │       플레이어4      │
│    [프로필]        └─────────────────┘       [프로필]       │
│    자원: ...                                 자원: ...      │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│ ┌───────────────────────────────────────────────────────┐   │
│ │              내 개인 보드 (건축가의 책상)              │   │
│ │  ┌────┐ ┌────┐ ┌────┐     자원: 목 석 기 먹          │   │
│ │  │채석│ │벌목│ │기와│            2  3  1  2          │   │
│ │  └────┘ └────┘ └────┘                                 │   │
│ │  [견습공 3/5]  [관료 2/4]                             │   │
│ └───────────────────────────────────────────────────────┘   │
├─────────────────────────────────────────────────────────────┤
│ [드래프팅] [자원획득] [건설] [등록]          [턴 종료]      │
└─────────────────────────────────────────────────────────────┘
```

---

## Decision Log 참조

| ID | 항목 | 선택 | 근거 |
|----|------|------|------|
| D-03 | UI 스타일 | Board Game Arena 스타일 | 깔끔하고 기능적인 2D |
| D-08 | 게임 화면 | 메인보드 중앙 + 개인보드 하단 | 중요한 정보 중심 배치 |
| D-09 | 액션 버튼 | 하단 고정 | 빠른 액션 접근성 |
